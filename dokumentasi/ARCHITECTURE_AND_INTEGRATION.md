# ğŸ—ï¸ Arsitektur Sistem & Integrasi API - Pohonku

**Versi:** 1.0  
**Tanggal:** February 2026

---

## ğŸ“‹ Daftar Isi

1. [Arsitektur Sistem](#arsitektur-sistem)
2. [Data Flow Architecture](#data-flow-architecture)
3. [Component Integration Map](#component-integration-map)
4. [API Request/Response Cycle](#api-requestresponse-cycle)
5. [State Management Pattern](#state-management-pattern)
6. [Error Handling Architecture](#error-handling-architecture)
7. [Performance Optimization](#performance-optimization)
8. [Security Considerations](#security-considerations)

---

## Arsitektur Sistem

### High-Level Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER BROWSER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚            Next.js 14 Frontend Application                   â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚              Pages & Routes                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - /              (Home)                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - /adopt         (Adopt Species)                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - /dashboard     (User Dashboard)                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - /species       (Species Details)                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - /auth/google   (Authentication)                     â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                           â†•                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚              Components Layer                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - UI Components (Cards, Modals, etc)                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Feature Components (Adopt, Dashboard, etc)         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Shared Components (Navbar, Footer, etc)            â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                           â†•                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚              State Management                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - useState for local state                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - useEffect for data fetching                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - localStorage for token persistence                 â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                           â†•                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚              API Client Layer                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - apiFetch (Base Wrapper)                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - apiSpecies (Trees/Species)                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - apiOrder (Orders/Adoption)                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - apiDashboard (User Dashboard)                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - apiLogin (Authentication)                           â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                           â†• HTTP/HTTPS                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“â†‘
                        REST API Calls
                         (JSON/HTTP)
                              â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND SERVER                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚          Express.js / Node.js Backend                        â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚              API Routes/Controllers                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  GET    /api/v1/trees/species                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  GET    /api/v1/trees/species/:id                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  GET    /api/v1/trees/species/category/:cat            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  POST   /api/v1/orders                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  POST   /api/v1/orders/:id/payment                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  GET    /api/v1/adoptions                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  GET    /api/v1/adoptions/:id                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  GET    /api/v1/adoptions/stats                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  GET    /api/v1/auth/me                                â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                           â†•                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚          Business Logic / Services                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Species Service                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Order Service                                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Adoption Service                                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Payment Service (Midtrans integration)              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - User Service                                        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                           â†•                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚              Database Layer                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Species Table                                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Trees Table                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Orders Table                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Adoptions Table                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Users Table                                         â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“â†‘
                        HTTP Requests
                              â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EXTERNAL SERVICES                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   MIDTRANS GATEWAY     â”‚  â”‚  GOOGLE OAUTH 2.0              â”‚ â”‚
â”‚  â”‚  - Snap Payment        â”‚  â”‚  - User Authentication         â”‚ â”‚
â”‚  â”‚  - Transaction Status  â”‚  â”‚  - Profile Sync                â”‚ â”‚
â”‚  â”‚  - Settlement          â”‚  â”‚                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Technology Stack

```
Frontend:
â”œâ”€â”€ Framework:     Next.js 14.2.15 (React 18.3.1)
â”œâ”€â”€ Language:      TypeScript
â”œâ”€â”€ Styling:       Tailwind CSS
â”œâ”€â”€ HTTP Client:   Fetch API (native)
â””â”€â”€ Storage:       localStorage (JWT tokens)

Backend (Referenced):
â”œâ”€â”€ Framework:     Express.js / Node.js
â”œâ”€â”€ Language:      JavaScript / TypeScript
â”œâ”€â”€ Database:      PostgreSQL (assumed)
â”œâ”€â”€ ORM:           Prisma (assumed)
â””â”€â”€ API Style:     REST

External Integrations:
â”œâ”€â”€ Payment:       Midtrans (Snap Payment Gateway)
â”œâ”€â”€ Auth:          Google OAuth 2.0
â””â”€â”€ CDN:           Cloudinary (for images)
```

---

## Data Flow Architecture

### 1. Species/Tree Catalog Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Opens /adoptâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component Mounts                    â”‚
â”‚ useEffect triggered                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Call: GET /api/v1/trees/species â”‚
â”‚ Via: getTree.searchSpecies()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response Processing          â”‚
â”‚ - Check response.success     â”‚
â”‚ - Extract response.data      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State Update                 â”‚
â”‚ setSpeciesList()            â”‚
â”‚ setFilteredSpecies()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI Render                    â”‚
â”‚ Map species to Cards        â”‚
â”‚ Display category filters    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Interaction       â”‚
â”‚ - Search input        â”‚
â”‚ - Category select     â”‚
â”‚ - Click "Adopsi"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Filter/Search Action        â”‚
â”‚ (with 300ms debounce)       â”‚
â”‚ API Call: GET ...species    â”‚
â”‚ ?search=X&category=Y        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Order Creation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Clicks "Adopsi"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OrderModal Opens                â”‚
â”‚ - Show species info             â”‚
â”‚ - Input for "nameOnTag"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Fills Form & Submits       â”‚
â”‚ - nameOnTag validated          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Call: POST /api/v1/orders   â”‚
â”‚ Payload:                        â”‚
â”‚ {                              â”‚
â”‚   speciesId: string,           â”‚
â”‚   nameOnTag: string            â”‚
â”‚ }                              â”‚
â”‚ Header:                        â”‚
â”‚ Authorization: Bearer {token}  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend Processing              â”‚
â”‚ - Validate species exists      â”‚
â”‚ - Check stock/availability     â”‚
â”‚ - Create order record          â”‚
â”‚ - Set status: PENDING_PAYMENT  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response:                        â”‚
â”‚ {                              â”‚
â”‚   success: true,               â”‚
â”‚   data: {                      â”‚
â”‚     id: "order_001",           â”‚
â”‚     orderId: "ORD-XXX-001",    â”‚
â”‚     totalAmount: 150000        â”‚
â”‚   }                            â”‚
â”‚ }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Processing             â”‚
â”‚ - Store orderId in state       â”‚
â”‚ - Close OrderModal             â”‚
â”‚ - Open PaymentModal            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Payment Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PaymentModal Opens           â”‚
â”‚ Show:                        â”‚
â”‚ - Order summary              â”‚
â”‚ - Total amount               â”‚
â”‚ - Payment button             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Clicks "Bayar Sekarang"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Call: POST /api/v1/orders/:id/   â”‚
â”‚           payment                     â”‚
â”‚ Header:                              â”‚
â”‚ Authorization: Bearer {token}        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend Processing              â”‚
â”‚ - Verify order exists          â”‚
â”‚ - Check order status           â”‚
â”‚ - Call Midtrans API            â”‚
â”‚ - Generate Snap Token          â”‚
â”‚ - Return token to frontend     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response:                        â”‚
â”‚ {                              â”‚
â”‚   success: true,               â”‚
â”‚   data: {                      â”‚
â”‚     token: "SNAP_TOKEN_XXX",   â”‚
â”‚     redirectUrl: "https://..."  â”‚
â”‚   }                            â”‚
â”‚ }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Processing             â”‚
â”‚ - Load Midtrans Snap script    â”‚
â”‚ - Trigger window.snap.pay()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Midtrans Snap Opens             â”‚
â”‚ - Show payment methods:         â”‚
â”‚   â€¢ Bank Transfer              â”‚
â”‚   â€¢ E-Wallet                   â”‚
â”‚   â€¢ Credit Card                â”‚
â”‚   â€¢ etc                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Selects Payment Method      â”‚
â”‚ & Completes Payment              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Midtrans Gateway Processing     â”‚
â”‚ - Verify payment method         â”‚
â”‚ - Process transaction           â”‚
â”‚ - Confirm payment               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Callback to Frontend             â”‚
â”‚ snap.pay(token, {                â”‚
â”‚   onSuccess: (result) => {},    â”‚
â”‚   onPending: (result) => {},    â”‚
â”‚   onError: (result) => {}       â”‚
â”‚ })                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Callback Handling       â”‚
â”‚ - onSuccess:                    â”‚
â”‚   â€¢ Show success notification   â”‚
â”‚   â€¢ Close modals                â”‚
â”‚   â€¢ Redirect to dashboard      â”‚
â”‚ - onError:                      â”‚
â”‚   â€¢ Show error message          â”‚
â”‚   â€¢ Allow retry                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend Webhook (from Midtrans)  â”‚
â”‚ - Receive payment notification  â”‚
â”‚ - Update order status: PAID     â”‚
â”‚ - Create adoption record        â”‚
â”‚ - Assign tree to user           â”‚
â”‚ - Send confirmation email       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Dashboard/Adoption View Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Opens /dashboard      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check Authentication        â”‚
â”‚ - Get token from localStorage
â”‚ - If missing: redirect loginâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Parallel API Calls (Promise.all) â”‚
â”‚                                 â”‚
â”‚ Call 1: GET /api/v1/adoptions  â”‚
â”‚ Call 2: GET /api/v1/adoptions/ â”‚
â”‚         stats                   â”‚
â”‚                                 â”‚
â”‚ Both with Authorization header  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response Processing              â”‚
â”‚ - Adoptions array               â”‚
â”‚ - Statistics object             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State Updates                    â”‚
â”‚ setAdoptions(array)             â”‚
â”‚ setStats(stats)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI Render                        â”‚
â”‚ - AdoptionStats (top)           â”‚
â”‚ - AdoptionList (main)           â”‚
â”‚   â€¢ Show each adoption card     â”‚
â”‚   â€¢ With view detail button     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Clicks Adoption Card  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Call: GET /api/v1/adoptions/ â”‚
â”‚           :adoptionId            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response: Full Adoption Detail   â”‚
â”‚ - Species info                  â”‚
â”‚ - Tree location & status        â”‚
â”‚ - CO2 stats                     â”‚
â”‚ - Growth progress               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Display AdoptionDetailModal      â”‚
â”‚ - Show all details              â”‚
â”‚ - Map visualization             â”‚
â”‚ - Statistics display            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Integration Map

### Feature: Adopt (Adoption Page)

```
/adopt/page.tsx (Main Page)
â”œâ”€â”€ STATE:
â”‚   â”œâ”€â”€ speciesList: Species[]
â”‚   â”œâ”€â”€ filteredSpecies: Species[]
â”‚   â”œâ”€â”€ selectedCategory: string
â”‚   â”œâ”€â”€ searchQuery: string
â”‚   â”œâ”€â”€ showOrderModal: boolean
â”‚   â””â”€â”€ selectedSpecies: Species | null
â”‚
â”œâ”€â”€ EFFECTS:
â”‚   â”œâ”€â”€ fetchAllSpecies() on mount
â”‚   â””â”€â”€ debounced filterSpecies() on search/category
â”‚
â”œâ”€â”€ CHILDREN:
â”‚   â”œâ”€â”€ SearchBox component
â”‚   â”‚   â””â”€â”€ onChange: setSearchQuery()
â”‚   â”‚
â”‚   â”œâ”€â”€ CategoryButtons component
â”‚   â”‚   â””â”€â”€ onChange: setSelectedCategory()
â”‚   â”‚
â”‚   â”œâ”€â”€ SpeciesGrid
â”‚   â”‚   â””â”€â”€ AdoptSpeciesCard[] (repeated)
â”‚   â”‚       â”œâ”€â”€ Props:
â”‚   â”‚       â”‚   â”œâ”€â”€ species: Species
â”‚   â”‚       â”‚   â””â”€â”€ onAdoptClick: (species) => void
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ Events:
â”‚   â”‚           â”œâ”€â”€ onClick "Adopsi":
â”‚   â”‚           â”‚   â””â”€â”€ setSelectedSpecies(species)
â”‚   â”‚           â”‚       setShowOrderModal(true)
â”‚   â”‚           â”‚
â”‚   â”‚           â””â”€â”€ onClick "Detail":
â”‚   â”‚               â””â”€â”€ navigate to /species/:id
â”‚   â”‚
â”‚   â””â”€â”€ OrderModal (conditional render)
â”‚       â”œâ”€â”€ Props:
â”‚       â”‚   â”œâ”€â”€ species: Species
â”‚       â”‚   â””â”€â”€ onClose: () => void
â”‚       â”‚
â”‚       â””â”€â”€ INTERNAL:
â”‚           â”œâ”€â”€ STATE:
â”‚           â”‚   â”œâ”€â”€ nameOnTag: string
â”‚           â”‚   â”œâ”€â”€ isLoading: boolean
â”‚           â”‚   â”œâ”€â”€ orderId: string | null
â”‚           â”‚   â””â”€â”€ showPaymentModal: boolean
â”‚           â”‚
â”‚           â””â”€â”€ FLOW:
â”‚               â””â”€â”€ handleCreateOrder()
â”‚                   â”œâ”€â”€ Validate nameOnTag
â”‚                   â”œâ”€â”€ API: POST /api/v1/orders
â”‚                   â”œâ”€â”€ On success:
â”‚                   â”‚   â”œâ”€â”€ setOrderId()
â”‚                   â”‚   â””â”€â”€ setShowPaymentModal(true)
â”‚                   â””â”€â”€ On error:
â”‚                       â””â”€â”€ setError()
â”‚
â”‚                   â””â”€â”€ PaymentModal (nested conditional)
â”‚                       â”œâ”€â”€ STATE:
â”‚                       â”‚   â””â”€â”€ isLoading: boolean
â”‚                       â”‚
â”‚                       â””â”€â”€ FLOW:
â”‚                           â””â”€â”€ handlePayment()
â”‚                               â”œâ”€â”€ API: POST /api/v1/orders/:orderId/payment
â”‚                               â”œâ”€â”€ Get Snap Token
â”‚                               â”œâ”€â”€ Load Midtrans script
â”‚                               â””â”€â”€ window.snap.pay()
â”‚                                   â”œâ”€â”€ onSuccess
â”‚                                   â”œâ”€â”€ onPending
â”‚                                   â””â”€â”€ onError

API CALLS CHAIN:
1. getTree.searchSpecies()         // Get all species
   GET /api/v1/trees/species

2. getTree.searchSpecies(q, cat)   // Filter species (debounced)
   GET /api/v1/trees/species?search=X&category=Y

3. orderApi.createOrder(data)      // Create order
   POST /api/v1/orders
   Payload: { speciesId, nameOnTag }
   Headers: Authorization: Bearer {token}

4. orderApi.createPayment(orderId) // Get payment token
   POST /api/v1/orders/:orderId/payment
   Headers: Authorization: Bearer {token}

5. Midtrans Snap payment          // External payment processing
   window.snap.pay(TOKEN)
```

### Feature: Dashboard

```
/dashboard/page.tsx (Main Page)
â”œâ”€â”€ STATE:
â”‚   â”œâ”€â”€ adoptions: Adoption[]
â”‚   â”œâ”€â”€ stats: Stats | null
â”‚   â”œâ”€â”€ selectedAdoption: Adoption | null
â”‚   â”œâ”€â”€ loading: boolean
â”‚   â”œâ”€â”€ error: string | null
â”‚   â””â”€â”€ isModalOpen: boolean
â”‚
â”œâ”€â”€ EFFECTS:
â”‚   â””â”€â”€ fetchDashboardData() on mount
â”‚       â”œâ”€â”€ Parallel API calls:
â”‚       â”‚   â”œâ”€â”€ dashboardApi.getDashboard()
â”‚       â”‚   â”‚   GET /api/v1/adoptions
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ dashboardApi.getStatsAdoption()
â”‚       â”‚       GET /api/v1/adoptions/stats
â”‚       â”‚
â”‚       â”œâ”€â”€ Both with Authorization header
â”‚       â””â”€â”€ Error handling
â”‚
â”œâ”€â”€ CHILDREN:
â”‚   â”œâ”€â”€ LoadingSpinner (conditional)
â”‚   â”‚   â””â”€â”€ shown when loading = true
â”‚   â”‚
â”‚   â”œâ”€â”€ ErrorMessage (conditional)
â”‚   â”‚   â””â”€â”€ shown when error exists
â”‚   â”‚
â”‚   â”œâ”€â”€ AdoptionStats component
â”‚   â”‚   â”œâ”€â”€ Props: stats: Stats
â”‚   â”‚   â””â”€â”€ Display:
â”‚   â”‚       â”œâ”€â”€ totalAdoptions
â”‚   â”‚       â”œâ”€â”€ totalTreesPlanted
â”‚   â”‚       â”œâ”€â”€ totalCarbonAbsorbed
â”‚   â”‚       â””â”€â”€ lastMonthAdoptions
â”‚   â”‚
â”‚   â”œâ”€â”€ AdoptionList component
â”‚   â”‚   â”œâ”€â”€ Props: adoptions: Adoption[]
â”‚   â”‚   â””â”€â”€ AdoptionListItem[] (repeated)
â”‚   â”‚       â”œâ”€â”€ Display adoption info
â”‚   â”‚       â””â”€â”€ onClick:
â”‚   â”‚           â”œâ”€â”€ setSelectedAdoption(adoption)
â”‚   â”‚           â”œâ”€â”€ handleViewDetail(adoptionId)
â”‚   â”‚           â”‚   â””â”€â”€ API: GET /api/v1/adoptions/:adoptionId
â”‚   â”‚           â”‚       Headers: Authorization: Bearer {token}
â”‚   â”‚           â””â”€â”€ setIsModalOpen(true)
â”‚   â”‚
â”‚   â””â”€â”€ AdoptionDetailModal (conditional)
â”‚       â”œâ”€â”€ Props:
â”‚       â”‚   â”œâ”€â”€ adoption: Adoption
â”‚       â”‚   â””â”€â”€ onClose: () => void
â”‚       â”‚
â”‚       â””â”€â”€ Display:
â”‚           â”œâ”€â”€ Species information
â”‚           â”œâ”€â”€ Tree details
â”‚           â”‚   â”œâ”€â”€ Location (latitude, longitude)
â”‚           â”‚   â”œâ”€â”€ Status (ACTIVE, INACTIVE, etc)
â”‚           â”‚   â”œâ”€â”€ Planted date
â”‚           â”‚   â””â”€â”€ Health status
â”‚           â”œâ”€â”€ Statistics
â”‚           â”‚   â”œâ”€â”€ Days active
â”‚           â”‚   â”œâ”€â”€ CO2 absorbed
â”‚           â”‚   â””â”€â”€ Growth progress
â”‚           â””â”€â”€ Map visualization

API CALLS CHAIN:
1. dashboardApi.getDashboard()     // Get adoptions list
   GET /api/v1/adoptions
   Headers: Authorization: Bearer {token}

2. dashboardApi.getStatsAdoption() // Get statistics
   GET /api/v1/adoptions/stats
   Headers: Authorization: Bearer {token}
   (parallel with #1)

3. dashboardApi.getAdoptionDetail(adoptionId)  // Get detail
   GET /api/v1/adoptions/:adoptionId
   Headers: Authorization: Bearer {token}
```

---

## API Request/Response Cycle

### Request Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React Component (e.g., OrderModal)    â”‚
â”‚                                         â”‚
â”‚   const handleSubmit = async () => {    â”‚
â”‚     const response = await              â”‚
â”‚       orderApi.createOrder(data)        â”‚
â”‚   }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Module (apiOrder.ts)              â”‚
â”‚                                         â”‚
â”‚   export const orderApi = {             â”‚
â”‚     async createOrder(data) {           â”‚
â”‚       return apiFetch<any>(              â”‚
â”‚         '/api/v1/orders',               â”‚
â”‚         { method: 'POST',               â”‚
â”‚           body: JSON.stringify(data) }  â”‚
â”‚       )                                 â”‚
â”‚     }                                   â”‚
â”‚   }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Wrapper (apiFetch)                â”‚
â”‚                                         â”‚
â”‚   1. Get token from localStorage        â”‚
â”‚   2. Validate BASE_URL                  â”‚
â”‚   3. Build full URL                     â”‚
â”‚   4. Prepare headers:                   â”‚
â”‚      {                                  â”‚
â”‚        Content-Type: 'application/json',â”‚
â”‚        Authorization:                   â”‚
â”‚          'Bearer {token}',              â”‚
â”‚      }                                  â”‚
â”‚   5. Make fetch request                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Network Layer (HTTP)                  â”‚
â”‚                                         â”‚
â”‚   POST http://localhost:8000/api/v1/   â”‚
â”‚        orders                           â”‚
â”‚                                         â”‚
â”‚   Headers: {                            â”‚
â”‚     Content-Type: application/json,    â”‚
â”‚     Authorization: Bearer token,       â”‚
â”‚   }                                     â”‚
â”‚                                         â”‚
â”‚   Body: {                               â”‚
â”‚     speciesId: "spec_001",             â”‚
â”‚     nameOnTag: "John Doe"              â”‚
â”‚   }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ (over the internet)
               
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend Server (Express.js)           â”‚
â”‚                                         â”‚
â”‚   Route: POST /api/v1/orders            â”‚
â”‚   Middleware:                           â”‚
â”‚     â”œâ”€â”€ CORS check                      â”‚
â”‚     â”œâ”€â”€ JSON parser                     â”‚
â”‚     â”œâ”€â”€ Auth middleware (verify token)  â”‚
â”‚     â””â”€â”€ Validation middleware           â”‚
â”‚                                         â”‚
â”‚   Controller:                           â”‚
â”‚     â”œâ”€â”€ Validate request data           â”‚
â”‚     â”œâ”€â”€ Call Order Service              â”‚
â”‚     â”œâ”€â”€ Create order in database        â”‚
â”‚     â””â”€â”€ Build response                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Response (JSON)                       â”‚
â”‚                                         â”‚
â”‚   {                                     â”‚
â”‚     success: true,                      â”‚
â”‚     data: {                             â”‚
â”‚       id: "order_001",                  â”‚
â”‚       orderId: "ORD-2026021-001",       â”‚
â”‚       userId: "user_001",               â”‚
â”‚       speciesId: "spec_001",            â”‚
â”‚       totalAmount: 150000,              â”‚
â”‚       status: "PENDING_PAYMENT",        â”‚
â”‚       nameOnTag: "John Doe",            â”‚
â”‚       createdAt: "2026-02-21T..."       â”‚
â”‚     },                                  â”‚
â”‚     message: "Order created successfully"â”‚
â”‚   }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ (over the internet)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Response Processing (apiFetch)        â”‚
â”‚                                         â”‚
â”‚   1. Check res.ok (status 200-299)      â”‚
â”‚   2. If OK:                             â”‚
â”‚      â””â”€â”€ Parse JSON                     â”‚
â”‚          â””â”€â”€ Return typed data          â”‚
â”‚   3. If NOT OK:                         â”‚
â”‚      â”œâ”€â”€ Parse error JSON               â”‚
â”‚      â””â”€â”€ Throw Error with message       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Component (Error Handling)            â”‚
â”‚                                         â”‚
â”‚   try {                                 â”‚
â”‚     response = await orderApi...        â”‚
â”‚     // Success: update state            â”‚
â”‚     setOrderId(response.data.id)        â”‚
â”‚     setShowPaymentModal(true)           â”‚
â”‚   } catch (error) {                     â”‚
â”‚     // Error: show message              â”‚
â”‚     setError(error.message)             â”‚
â”‚   }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Response Status Codes

```
âœ… 2xx Success
â”œâ”€â”€ 200 OK - Request successful
â”œâ”€â”€ 201 Created - Resource created (POST)
â””â”€â”€ 204 No Content - Request successful, no body

âŒ 4xx Client Error
â”œâ”€â”€ 400 Bad Request - Invalid data
â”œâ”€â”€ 401 Unauthorized - Invalid/expired token
â”œâ”€â”€ 403 Forbidden - Not allowed
â””â”€â”€ 404 Not Found - Resource not found

âŒ 5xx Server Error
â”œâ”€â”€ 500 Internal Server Error
â”œâ”€â”€ 502 Bad Gateway
â””â”€â”€ 503 Service Unavailable
```

---

## State Management Pattern

### Local Component State Pattern

```typescript
// Pattern: useState for component-level state
const [data, setData] = useState<T | null>(null);
const [loading, setLoading] = useState(false);
const [error, setError] = useState<string | null>(null);

// Usage
useEffect(() => {
  const fetch = async () => {
    try {
      setLoading(true);
      setError(null);
      const result = await api.call();
      setData(result);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Error');
    } finally {
      setLoading(false);
    }
  };
  fetch();
}, []);

// Render
return (
  <>
    {loading && <Spinner />}
    {error && <ErrorAlert message={error} />}
    {data && <Display data={data} />}
  </>
);
```

### Token Management Pattern

```typescript
// 1. Store token after login
const handleLoginSuccess = (token: string) => {
  localStorage.setItem('access_token', token);
  // Redirect to dashboard
};

// 2. Auto-attach token to requests (in apiFetch)
const token = localStorage.getItem('access_token');
const headers = {
  ...options.headers,
  ...(token && { Authorization: `Bearer ${token}` }),
};

// 3. Handle 401 responses (add to apiFetch error handling)
if (res.status === 401) {
  // Token expired or invalid
  localStorage.removeItem('access_token');
  window.location.href = '/auth/login';
}

// 4. Logout
const handleLogout = () => {
  localStorage.removeItem('access_token');
  window.location.href = '/';
};
```

### Debounce Pattern

```typescript
const [debounceTimer, setDebounceTimer] = useState<NodeJS.Timeout | null>(null);

useEffect(() => {
  // Clear previous timer
  if (debounceTimer) {
    clearTimeout(debounceTimer);
  }

  // Set new timer
  const timer = setTimeout(() => {
    // Execute after 300ms of no changes
    performSearch(searchQuery);
  }, 300);

  setDebounceTimer(timer);

  // Cleanup on unmount
  return () => {
    if (timer) {
      clearTimeout(timer);
    }
  };
}, [searchQuery]); // Re-run when searchQuery changes
```

### Cache Pattern

```typescript
const [cache, setCache] = useState<Map<string, Species>>(new Map());

const getWithCache = async (id: string): Promise<Species> => {
  // Check cache
  if (cache.has(id)) {
    return cache.get(id)!;
  }

  // Fetch from API
  const data = await api.get(id);

  // Update cache
  const newCache = new Map(cache);
  newCache.set(id, data);
  setCache(newCache);

  return data;
};
```

---

## Error Handling Architecture

### Error Handling Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. API Wrapper Layer (apiFetch)              â”‚
â”‚                                              â”‚
â”‚ catch (error) {                              â”‚
â”‚   if (!res.ok) {                             â”‚
â”‚     const errorData = await res.json()       â”‚
â”‚     throw new Error(errorData.message)       â”‚
â”‚   }                                          â”‚
â”‚ }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. API Module Layer (apiOrder, etc)          â”‚
â”‚                                              â”‚
â”‚ async createOrder(data) {                    â”‚
â”‚   return apiFetch<T>(...options)             â”‚
â”‚   // Propagates error from apiFetch          â”‚
â”‚ }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Component Layer (OrderModal, etc)         â”‚
â”‚                                              â”‚
â”‚ try {                                        â”‚
â”‚   const response = await orderApi.create()   â”‚
â”‚   // Success handling                        â”‚
â”‚ } catch (err) {                              â”‚
â”‚   // Error handling                          â”‚
â”‚   setError(err.message)                      â”‚
â”‚   showNotification('Error: ' + err.message)  â”‚
â”‚ }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### HTTP Status Error Mapping

```typescript
// In apiFetch error handling
const handleApiError = (res: Response, errorData: any) => {
  switch (res.status) {
    case 400:
      throw new Error(errorData.message || 'Invalid request data');
    case 401:
      // Redirect to login
      localStorage.removeItem('access_token');
      window.location.href = '/auth/login';
      throw new Error('Session expired. Please login again.');
    case 403:
      throw new Error('You do not have permission to perform this action');
    case 404:
      throw new Error('Resource not found');
    case 500:
      throw new Error('Server error. Please try again later.');
    default:
      throw new Error(errorData.message || `HTTP Error ${res.status}`);
  }
};
```

### User Feedback Pattern

```typescript
// Show error to user
const [error, setError] = useState<string | null>(null);

const handleError = (err: any) => {
  const message = err instanceof Error ? err.message : 'Unknown error';
  setError(message);
  
  // Auto-hide after 5 seconds
  setTimeout(() => setError(null), 5000);
};

// Render
{error && (
  <div className="alert alert-error">
    {error}
    <button onClick={() => setError(null)}>âœ•</button>
  </div>
)}
```

---

## Performance Optimization

### 1. Request Deduplication

```typescript
// Prevent duplicate simultaneous requests
const [isLoading, setIsLoading] = useState(false);

const fetchData = async () => {
  if (isLoading) return; // Already loading
  
  setIsLoading(true);
  try {
    const data = await api.call();
    setData(data);
  } finally {
    setIsLoading(false);
  }
};
```

### 2. Response Caching

```typescript
const [speciesCache, setSpeciesCache] = useState<
  Map<string, Species>
>(new Map());

const getSpecies = async (id: string): Promise<Species> => {
  if (speciesCache.has(id)) {
    return speciesCache.get(id)!; // Return cached
  }
  
  const species = await api.getSpeciesById(id);
  
  // Cache for future requests
  const newCache = new Map(speciesCache);
  newCache.set(id, species);
  setSpeciesCache(newCache);
  
  return species;
};
```

### 3. Lazy Loading

```typescript
// Load modals/content only when needed
{showOrderModal && selectedSpecies && (
  <OrderModal
    species={selectedSpecies}
    onClose={() => setShowOrderModal(false)}
  />
)}
```

### 4. Parallel Requests

```typescript
// Fetch multiple endpoints simultaneously
const [adoptions, setAdoptions] = useState([]);
const [stats, setStats] = useState(null);

useEffect(() => {
  Promise.all([
    dashboardApi.getDashboard(),
    dashboardApi.getStatsAdoption(),
  ]).then(([adoptionsRes, statsRes]) => {
    setAdoptions(adoptionsRes.data);
    setStats(statsRes.data);
  });
}, []);
```

### 5. Image Optimization

```typescript
// Next.js Image component (optimized)
import Image from 'next/image';

<Image
  src={species.mainImageUrl}
  alt={species.name}
  width={300}
  height={300}
  priority={false} // Lazy load
  quality={75}     // Compress
/>
```

---

## Security Considerations

### 1. Token Security

```typescript
// âœ… Store in localStorage (client-side)
localStorage.setItem('access_token', token);

// âš ï¸ Vulnerable to XSS
// âœ… Mitigated by:
// - Content Security Policy (CSP)
// - Input sanitization
// - Output encoding

// âŒ NEVER store in:
// - Cookies (vulnerable to CSRF if not httpOnly)
// - Session storage (lost on page close)
// - Regular variables (lost on reload)
```

### 2. CORS Security

```typescript
// Backend must properly configure CORS:
// âœ… Allow only specific origins
// âœ… Only allow needed methods (GET, POST)
// âœ… Only allow needed headers
// âŒ Avoid: Access-Control-Allow-Origin: *

// Frontend automatically includes credentials
const options = {
  credentials: 'include', // For cookies if using them
};
```

### 3. Data Validation

```typescript
// âœ… Validate on frontend (UX)
if (!nameOnTag.trim()) {
  setError('Nama di tag tidak boleh kosong');
  return;
}

// âœ… Backend ALWAYS validates (security)
// Frontend validation can be bypassed

// âœ… Type checking with TypeScript
interface CreateOrderPayload {
  speciesId: string;  // Required
  nameOnTag: string;  // Required
}
```

### 4. Error Messages

```typescript
// âœ… Safe: Generic message
throw new Error('Failed to process payment');

// âŒ Unsafe: Reveals internal details
throw new Error('Database connection failed to host 192.168.1.1');

// âœ… Log detailed info server-side only
console.error('Order creation failed for user:', userId);
```

### 5. API Rate Limiting

```typescript
// Client-side debounce to reduce requests
const [debounceTimer, setDebounceTimer] = useState<
  NodeJS.Timeout | null
>(null);

useEffect(() => {
  if (debounceTimer) clearTimeout(debounceTimer);
  
  const timer = setTimeout(() => {
    searchApi.search(query);
  }, 300); // Min 300ms between requests
  
  setDebounceTimer(timer);
}, [query]);

// Backend should also implement rate limiting
```

---

**Last Updated:** February 21, 2026  
**Status:** Complete Architecture Documentation
